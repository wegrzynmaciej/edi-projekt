<html>

<head>
    <title>Projekt EDI</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="scripts.js"></script>
    <!-- ŁADOWANIE BIBLIOTEKI WYKRESÓW https://naver.github.io/billboard.js/ START -->
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="billboard.min.js"></script>
    <link rel="stylesheet" href="billboard.min.css">
    <link rel="stylesheet" href="insight.min.css">
    <!-- ŁADOWANIE BIBLIOTEKI WYKRESÓW https://naver.github.io/billboard.js/ STOP -->

    <!-- ŁADOWANIE BOOTSTRAP START -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>
    <!-- ŁADOWANIE BOOTSTRAP STOP -->
</head>

<body>


    <br><br><br><br>
    <button id='AUD' onclick="generate_chart_NBP(currencies[this.id])">AUD</button>
    <button id='CAD' onclick="generate_chart_NBP(currencies[this.id])">CAD</button>
    <button id='CHF' onclick="generate_chart_NBP(currencies[this.id])">CHF</button>
    <button id='CZK' onclick="generate_chart_NBP(currencies[this.id])">CZK</button>
    <button id='DKK' onclick="generate_chart_NBP(currencies[this.id])">DKK</button>
    <button id='EUR' onclick="generate_chart_NBP(currencies[this.id])">EUR</button>
    <button id='GBP' onclick="generate_chart_NBP(currencies[this.id])">GBP</button>
    <button id='HUF' onclick="generate_chart_NBP(currencies[this.id])">HUF</button>
    <button id='JPY' onclick="generate_chart_NBP(currencies[this.id])">JPY</button>
    <button id='NOK' onclick="generate_chart_NBP(currencies[this.id])">NOK</button>
    <button id='SEK' onclick="generate_chart_NBP(currencies[this.id])">SEK</button>
    <button id='USD' onclick="generate_chart_NBP(currencies[this.id])">USD</button>
    <button id='XDR' onclick="generate_chart_NBP(currencies[this.id])">XDR</button>
    <br><br><br><br>
    <div class="text-center">
        <div id="spinner" class="spinner-border" style="width: 3rem;height: 3rem;" role="status">
            <span class="sr-only">Loading...</span>
        </div>
        <div id="chart"></div>
    </div>
    <br><br><br>
    <div class="text-center">
        <div id="spinner2" class="spinner-border" style="width: 3rem;height: 3rem;" role="status">
            <span class="sr-only">Loading...</span>
        </div>
        <div id="chart_ages"></div>
        <div id="chart_nats"></div>
        <div id="chart_genders"></div>
    </div>


    <script>
        // Deklaracja słownika walut
        var currencies = {};
        $('#spinner').show();
        $(document).ready(function () {

            // URL z api NBP żeby wyciągnąć symbole i nazwy walut
            var url_symbols = 'http://api.nbp.pl/api/exchangerates/tables/C';
            // Zapytanie do najprostszego api NBP z tabeli C (kupno/sprzedaż)
            $.ajax({
                url: url_symbols,
                dataType: 'json',
                async: false,
                success: function (result) {
                    // Skrócenie zmiennej
                    let rates = result[0]['rates'];
                    // Populacja słownika
                    rates.forEach(element => {
                        // Nazwa waluty
                        let name = element['currency'];
                        // Symbol(kod) waluty
                        let symbol = element['code'];
                        // Populacja słownika po kluczu kodu waluty
                        currencies[symbol] = {
                            'name': name,
                            'months': {}
                        };
                        // Populacja miesięcy pustymi wartościami dla danej waluty
                        for (let x = 1; x <= 12; x++) {
                            currencies[symbol]['months'][x] = { 'bid': 0, 'ask': 0 }
                        };

                    });
                    // Wywołanie funkcji pobierającej średnią wartość kupna i sprzedaży walut z tabeli C dla każego miesiąca w 2019 roku
                    for (let x = 1; x <= 12; x++) {
                        get_nbp_data_month(x, currencies);
                    }
                    // generate_chart_NBP(currencies['AUD'])
                    $('#spinner').hide();

                    $("#spinner2").show();
                    var statictics = {
                        'nationalities': {
                            'AU': 0,
                            'BR': 0,
                            'CA': 0,
                            'CH': 0,
                            'DE': 0,
                            'DK': 0,
                            'ES': 0,
                            'FI': 0,
                            'FR': 0,
                            'GB': 0,
                            'IE': 0,
                            'IR': 0,
                            'NO': 0,
                            'NL': 0,
                            'NZ': 0,
                            'TR': 0,
                            'US': 0
                        },
                        'ages': {
                            '0-10': 0,
                            '11-20': 0,
                            '21-30': 0,
                            '31-40': 0,
                            '41-50': 0,
                            '51-60': 0,
                            '61-70': 0,
                            '71-80': 0,
                            '81-90': 0,
                            '91-100': 0,
                            '100+': 0
                        },
                        'genders': {
                            'm': 0,
                            'f': 0
                        }
                    }
                    generate_users(statictics);
                    generate_charts_users(statictics);
                    console.log(statictics);
                }
            });
        });
    </script>

</body>

</html>